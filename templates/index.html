{% extends "base.html" %}

{% block content %}
<div class="welcome-screen">
    <!-- Progress Section -->
    <div class="progress-section">
        <div class="progress-card">
            <h3 class="progress-title">âœ¨ Magical Gifts Revealed: {{ summary.revealed_gifts }}/30 âœ¨</h3>
            {% if summary.revealed_gifts > 0 %}
                <p class="progress-percentage">ğŸŒŸ Adventure Progress: {{ "%.1f"|format(summary.completion_percentage) }}% Complete ğŸŒŸ</p>
                
                {% if summary.is_complete %}
                    <p class="completion-message">ğŸ† ALL WISHES GRANTED! ğŸ†</p>
                {% endif %}
            {% endif %}
        </div>
    </div>

    <!-- Gift Selection Grid -->
    {% if summary.remaining_gifts > 0 %}
        <div class="gift-selection-section">
            <h2 class="selection-title">ğŸ Choose Your Next Magical Gift! ğŸ</h2>

            

            
            <div class="gifts-grid">
                {% for gift in available_gifts %}
                    <div class="gift-card {% if is_special_gift(gift.id) %}special-gift{% endif %}" data-gift-id="{{ gift.id }}" onclick="revealGift({{ gift.id }})">
                        <div class="gift-icon">
                            {% if is_special_gift(gift.id) %}
                                <div class="special-present">ğŸ</div>
                            {% else %}
                                ğŸ
                            {% endif %}
                        </div>
                        <div class="gift-reveal-type">
                            {% if is_special_gift(gift.id) %}
                                <span class="special-reveal">âœ¨ Surprise Magic âœ¨</span>
                            {% else %}
                                <span class="magic-reveal">âœ¨ Magical âœ¨</span>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
            
        </div>
    {% else %}
        <div class="completion-celebration">
            <h2>ğŸ† ALL 30 MAGICAL GIFTS REVEALED! ğŸ†</h2>
            <p>ğŸ‚ Rafa's 30th Birthday Adventure is Complete! ğŸ‚</p>
            <p>âœ¨ Happy Birthday from all your Disney friends! âœ¨</p>
            <p>ğŸŒŸ May all your wishes come true! ğŸŒŸ</p>
        </div>
    {% endif %}

    <!-- Options Section -->
    <div class="options-section">
        <button class="option-btn" onclick="showProgressScreen()">ğŸ“Š View Progress</button>
        <button class="option-btn" onclick="showSettingsScreen()">âš™ï¸ Settings</button>
        
        {% if summary.revealed_gifts > 0 %}
            <button class="option-btn danger-btn" onclick="confirmReset()">ğŸ”„ Reset Game</button>
        {% endif %}
    </div>
</div>

<!-- Hidden screens that will be shown via JavaScript -->
<div id="revealScreen" class="screen hidden">
    <div class="reveal-container">
        <div class="reveal-animation-area" id="revealAnimationArea">
            <!-- Dynamic reveal animations will be inserted here -->
        </div>
        
        <div class="character-section">
            <h3 id="characterName" class="character-name">ğŸŒŸ Character Name ğŸŒŸ</h3>
            <div id="characterImage" class="character-image">
                <div class="character-placeholder">âœ¨ Character âœ¨</div>
            </div>
        </div>
        
        <div class="message-section">
            <div class="message-bubble">
                <h4 id="characterSpeaker">ğŸ’¬ Character says:</h4>
                <p id="characterMessage" class="character-message">Loading magical message...</p>
            </div>
        </div>
        
        <div class="gift-section">
            <h3 id="giftTitle" class="gift-title">ğŸ GIFT #0 ğŸ</h3>
            <div id="giftImage" class="gift-image">
                <div class="gift-placeholder">ğŸ Loading Gift ğŸ</div>
            </div>
        </div>
        
        <div class="reveal-controls">
            <button id="acceptGiftBtn" class="accept-btn" onclick="acceptGift()">ğŸ‰ ACCEPT THIS MAGICAL GIFT! ğŸ‰</button>
            <button class="back-btn" onclick="showHomeScreen()">â¬…ï¸ Back to Menu</button>
        </div>
    </div>
</div>



<div id="progressScreen" class="screen hidden">
    <h2 class="screen-title">ğŸ“Š Birthday Adventure Progress</h2>
    
    <div class="detailed-progress">
        <div class="progress-stats">
            <div class="stat-item">
                <span class="stat-value">{{ summary.revealed_gifts }}</span>
                <span class="stat-label">Gifts Revealed</span>
            </div>
            <div class="stat-item">
                <span class="stat-value">{{ summary.remaining_gifts }}</span>
                <span class="stat-label">Remaining</span>
            </div>
            <div class="stat-item">
                <span class="stat-value">{{ "%.1f"|format(summary.completion_percentage) }}%</span>
                <span class="stat-label">Complete</span>
            </div>
        </div>
        
        <div class="progress-bar-container">
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ summary.completion_percentage }}%"></div>
            </div>
        </div>
        
        <div class="revealed-gifts-grid">
            <h3>ğŸ Revealed Gifts:</h3>
            <div class="revealed-list">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <button class="back-btn" onclick="showHomeScreen()">â¬…ï¸ Back to Menu</button>
</div>

<div id="settingsScreen" class="screen hidden">
    <h2 class="screen-title">âš™ï¸ Oracle Settings</h2>
    
    <div class="settings-section">
        <h3>ğŸ® Game Settings:</h3>
        <div class="setting-info">

            <p>ğŸ­ Special animated reveals for all gifts</p>
            <p>ğŸ‚ Perfect for Rafa's 30th birthday celebration</p>
        </div>
    </div>
    
    <div class="settings-section">
        <h3>ğŸŒŸ Magic Status:</h3>
        <p id="apiStatus" class="api-status">âœ… Ready for Birthday Magic</p>
    </div>
    
    <button class="back-btn" onclick="showHomeScreen()">â¬…ï¸ Back to Menu</button>
</div>

<!-- Loading overlay -->
<div id="loadingOverlay" class="loading-overlay hidden">
    <div class="loading-content">
        <div class="spinner"></div>
        <p id="loadingText">âœ¨ Loading magical content... âœ¨</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Initialize with data from Flask
window.gameData = {
    summary: {{ summary | tojson | safe }},
    availableGifts: {{ available_gifts | tojson | safe }},
    allGifts: {{ all_gifts | tojson | safe }},
    session: {{ session_data | tojson | safe }}
};

// Define reveal methods for each gift
window.revealMethods = {
    1: "ğŸ© Magic Hat Reveal",
    2: "â­ Shooting Star",
    3: "ğŸ§šâ€â™€ï¸ Fairy Dust Sprinkle",
    4: "ğŸ° Castle Door Opening",
    6: "âœ¨ Magical Reveal",
    7: "ğŸª„ Magic Wand Tap",
    8: "ğŸ† Fireworks Explosion",
    9: "â„ï¸ Snow Globe Shake",
    11: "ğŸ“š Enchanted Book",
    12: "ğŸª Magic Mirror",
    13: "ğŸ§â€â™‚ï¸ Genie Lamp Rub",
    14: "ğŸŒŠ Ocean Wave Reveal",
    16: "ğŸ¦‹ Butterfly Transformation",
    17: "ğŸŒ™ Moonbeam Shine",
    18: "ğŸª Circus Magic",
    19: "ğŸŒˆ Rainbow Bridge",
    21: "ğŸ•¯ï¸ Candle Flame Dance",
    22: "ğŸµ Musical Note Float",
    23: "ğŸŒ¸ Flower Bloom",
    24: "âš¡ Lightning Strike",
    26: "ğŸŒŸ Constellation Form",
    27: "ğŸ­ Theater Curtain",
    28: "ğŸ§™â€â™‚ï¸ Wizard Spell",
    29: "ğŸ¨ Paint Brush Magic"
};
</script>
{% endblock %} 